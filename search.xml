<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ssh服务端配置文件整理</title>
      <link href="posts/3881.html"/>
      <url>posts/3881.html</url>
      
        <content type="html"><![CDATA[<h3 id="1-ssh远程登录配置文件说明"><a href="#1-ssh远程登录配置文件说明" class="headerlink" title="1. ssh远程登录配置文件说明"></a>1. ssh远程登录配置文件说明</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#$OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $</span><span class="token comment"># This is the sshd server system-wide configuration file.  See</span><span class="token comment"># sshd_config(5) for more information.</span><span class="token comment"># This sshd was compiled with PATH=/usr/bin:/bin:/usr/sbin:/sbin</span><span class="token comment"># The strategy used for options in the default sshd_config shipped with</span><span class="token comment"># OpenSSH is to specify options with their default value where</span><span class="token comment"># possible, but leave them commented.  Uncommented options override the</span><span class="token comment"># default value.</span><span class="token comment">#监听的端口</span><span class="token comment">#Port 22</span><span class="token comment">#家族地址，any表示同时监听ipv4和ipv6</span><span class="token comment">#AddressFamily any</span><span class="token comment">#监听本机所有IPv4地址</span><span class="token comment">#ListenAddress 0.0.0.0</span><span class="token comment">#监听本机所有IPv6地址</span><span class="token comment">#ListenAddress ::</span><span class="token comment">#ssh所使用的RSA私钥路径</span><span class="token comment">#HostKey /etc/ssh/ssh_host_rsa_key</span><span class="token comment">#HostKey /etc/ssh/ssh_host_ecdsa_key</span><span class="token comment">#HostKey /etc/ssh/ssh_host_ed25519_key</span><span class="token comment"># Ciphers and keying</span><span class="token comment">#RekeyLimit default none</span><span class="token comment"># Logging</span><span class="token comment">#设定在记录来自sshd的消息的时候，是否给出“facility code</span><span class="token comment">#SyslogFacility AUTH</span><span class="token comment">#日志记录级别，默认为info</span><span class="token comment">#LogLevel INFO</span><span class="token comment"># Authentication:</span><span class="token comment">#限定用户认证时间为2min</span><span class="token comment">#LoginGraceTime 2m</span><span class="token comment">#是否允许root账户ssh登录,生成环境使用root账号登录危害极大,自己玩玩就无所谓了</span><span class="token comment">#PermitRootLogin prohibit-password</span>PermitRootLogin <span class="token function">yes</span><span class="token comment">#设置ssh在接收登录请求之前是否检查用户根目录和rhosts文件的权限和所有权，建议开启</span><span class="token comment">#StrictModes yes</span><span class="token comment">#指定每个连接最大允许的认证次数。默认值是</span><span class="token comment">#MaxAuthTries 6</span><span class="token comment">#最大允许保持多少个连接。默认值是 10</span><span class="token comment">#MaxSessions 10</span><span class="token comment">#是否开启公钥验证</span><span class="token comment">#PubkeyAuthentication yes</span>PubkeyAuthentication <span class="token function">yes</span><span class="token comment"># Expect .ssh/authorized_keys2 to be disregarded by default in future.</span><span class="token comment">#公钥验证文件路径</span><span class="token comment">#AuthorizedKeysFile.ssh/authorized_keys .ssh/authorized_keys2</span>AuthorizedKeysFile.ssh/authorized_keys %h/.ssh/authorized_keys2<span class="token comment">#AuthorizedPrincipalsFile none</span><span class="token comment">#AuthorizedKeysCommand none</span><span class="token comment">#AuthorizedKeysCommandUser nobody</span><span class="token comment"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span><span class="token comment">#HostbasedAuthentication no</span><span class="token comment"># Change to yes if you don't trust ~/.ssh/known_hosts for</span><span class="token comment"># HostbasedAuthentication</span><span class="token comment">#IgnoreUserKnownHosts no</span><span class="token comment"># Don't read the user's ~/.rhosts and ~/.shosts files</span><span class="token comment">#IgnoreRhosts yes</span><span class="token comment"># To disable tunneled clear text passwords, change to no here!</span><span class="token comment">#是否允许密码验证</span><span class="token comment">#PasswordAuthentication yes</span>PasswordAuthentication <span class="token function">yes</span><span class="token comment">#是否允许空密码登录</span><span class="token comment">#PermitEmptyPasswords no</span><span class="token comment"># Change to yes to enable challenge-response passwords (beware issues with</span><span class="token comment"># some PAM modules and threads)</span><span class="token comment">#是否允许质疑-应答(challenge-response)认证</span>ChallengeResponseAuthentication no<span class="token comment"># Kerberos options</span><span class="token comment">#KerberosAuthentication no</span><span class="token comment">#KerberosOrLocalPasswd yes</span><span class="token comment">#KerberosTicketCleanup yes</span><span class="token comment">#KerberosGetAFSToken no</span><span class="token comment"># GSSAPI options</span><span class="token comment">#是否允许基于GSSAPI的用户认证</span><span class="token comment">#GSSAPIAuthentication no</span><span class="token comment">#是否在用户退出登录后自动销毁用户凭证缓存</span><span class="token comment">#GSSAPICleanupCredentials yes</span><span class="token comment">#GSSAPIStrictAcceptorCheck yes</span><span class="token comment">#GSSAPIKeyExchange no</span><span class="token comment"># Set this to 'yes' to enable PAM authentication, account processing,</span><span class="token comment"># and session processing. If this is enabled, PAM authentication will</span><span class="token comment"># be allowed through the ChallengeResponseAuthentication and</span><span class="token comment"># PasswordAuthentication.  Depending on your PAM configuration,</span><span class="token comment"># PAM authentication via ChallengeResponseAuthentication may bypass</span><span class="token comment"># the setting of "PermitRootLogin without-password".</span><span class="token comment"># If you just want the PAM account and session checks to run without</span><span class="token comment"># PAM authentication, then enable this but set PasswordAuthentication</span><span class="token comment"># and ChallengeResponseAuthentication to 'no'.</span><span class="token comment">#是否通过PAM验证</span>UsePAM <span class="token function">yes</span><span class="token comment">#AllowAgentForwarding yes</span><span class="token comment">#AllowTcpForwarding yes</span><span class="token comment">#是否允许远程主机连接本地的转发端口</span><span class="token comment">#GatewayPorts no</span><span class="token comment">#是否允许X11转发</span>X11Forwarding <span class="token function">yes</span><span class="token comment">#X11DisplayOffset 10</span><span class="token comment">#X11UseLocalhost yes</span><span class="token comment">#PermitTTY yes</span><span class="token comment">#是否在每一次交互式登录时打印 /etc/motd 文件的内</span>PrintMotd <span class="token function">yes</span><span class="token comment">#PrintLastLog yes</span>PrintLastLog <span class="token function">yes</span><span class="token comment">#TCPKeepAlive yes</span><span class="token comment">#PermitUserEnvironment no</span><span class="token comment">#Compression delayed</span><span class="token comment">#ClientAliveInterval 0</span><span class="token comment">#ClientAliveCountMax 3</span><span class="token comment">#UseDNS no</span><span class="token comment">#PidFile /var/run/sshd.pid</span><span class="token comment">#MaxStartups 10:30:100</span><span class="token comment">#PermitTunnel no</span><span class="token comment">#ChrootDirectory none</span><span class="token comment">#VersionAddendum none</span><span class="token comment"># no default banner path</span><span class="token comment">#Banner none</span><span class="token comment"># Allow client to pass locale environment variables</span>AcceptEnv <span class="token environment constant">LANG</span> LC_*<span class="token comment"># override default of no subsystems</span>Subsystem<span class="token function">sftp</span>/usr/lib/openssh/sftp-server<span class="token comment"># Example of overriding settings on a per-user basis</span><span class="token comment">#Match User anoncvs</span><span class="token comment">#X11Forwarding no</span><span class="token comment">#AllowTcpForwarding no</span><span class="token comment">#PermitTTY no</span><span class="token comment">#ForceCommand cvs server</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-普通用户使用密钥登录时出现的问题"><a href="#2-普通用户使用密钥登录时出现的问题" class="headerlink" title="2. 普通用户使用密钥登录时出现的问题"></a>2. 普通用户使用密钥登录时出现的问题</h3><h4 id="1-普通用户家目录下-ssh-authorized-keys-权限配置不对"><a href="#1-普通用户家目录下-ssh-authorized-keys-权限配置不对" class="headerlink" title="1. 普通用户家目录下 ./ssh/authorized_keys 权限配置不对"></a>1. 普通用户家目录下 ./ssh/authorized_keys 权限配置不对</h4><p><img src="./medias/detail/load.gif" data-original="https://blog.ryzezr.com/usr/uploads/2021/05/580441958.png"></p><p>此时<code>drcom</code>用户的<code> authorized_keys</code>文件是 <code>600</code>权限，虽然已经正确配置了密钥，但是登录时依然需要drcom用户提供密码</p><p>修改 <code>/home/drcom/.ssh/authorized_keys </code>的权限为 <code>644</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">644</span> authorized_keys<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="./medias/detail/load.gif" data-original="https://blog.ryzezr.com/usr/uploads/2021/05/3676596635.png"></p><p>修改完权限后，drcom能通过密钥正常登录</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="https://segmentfault.com/q/1010000000613569">普通用户 ssh 密钥登录失败的问题，困惑了很久</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh配置文件 </tag>
            
            <tag> ssh远程登录时遇到的问题 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
